# 要件定義

## 機能要件

### FR-001: 診断機能
| ID | 要件 | 優先度 |
|----|------|--------|
| FR-001-01 | 10問の選択式質問を表示する | Must |
| FR-001-02 | 回答に基づきスコアを計算する | Must |
| FR-001-03 | 4つの金融タイプのいずれかに分類する | Must |
| FR-001-04 | 診断結果をデータベースに保存する | Must |
| FR-001-05 | 結果ページでタイプ別アドバイスを表示する | Must |
| FR-001-06 | 診断進捗をプログレスバーで表示する | Should |

### FR-002: LINE連携
| ID | 要件 | 優先度 |
|----|------|--------|
| FR-002-01 | 診断結果ページからLINE友達追加へ誘導する | Must |
| FR-002-02 | Webhook経由でフォローイベントを受信する | Must |
| FR-002-03 | 診断結果とLINE IDを紐付ける | Must |
| FR-002-04 | 10日間のステップメッセージを配信する | Must |
| FR-002-05 | リッチメニューを設定する | Should |
| FR-002-06 | ユーザーからのメッセージに自動返信する | Could |

### FR-003: コンテンツ配信
| ID | 要件 | 優先度 |
|----|------|--------|
| FR-003-01 | 設定されたRSSフィードから記事を取得する | Must |
| FR-003-02 | Claude APIで記事を要約する | Must |
| FR-003-03 | ユーザータイプに応じてコンテンツを選択する | Should |
| FR-003-04 | 週1回ダイジェストをLINE配信する | Must |
| FR-003-05 | 配信履歴を記録する | Must |

### FR-004: 管理機能
| ID | 要件 | 優先度 |
|----|------|--------|
| FR-004-01 | 診断質問を設定ファイルで管理する | Must |
| FR-004-02 | RSSフィード一覧を設定ファイルで管理する | Must |
| FR-004-03 | ステップメッセージをコードで管理する | Must |

## 非機能要件

### NFR-001: パフォーマンス
| ID | 要件 | 目標値 |
|----|------|--------|
| NFR-001-01 | LP表示時間 | < 1.5秒 |
| NFR-001-02 | 診断結果計算・表示 | < 2秒 |
| NFR-001-03 | LINE Webhook応答 | < 1秒 |
| NFR-001-04 | ダイジェスト生成 | < 30秒/ユーザー |

### NFR-002: 可用性
| ID | 要件 | 目標値 |
|----|------|--------|
| NFR-002-01 | サービス稼働率 | 99.5% |
| NFR-002-02 | 計画外ダウンタイム | < 4時間/月 |

### NFR-003: セキュリティ
| ID | 要件 |
|----|------|
| NFR-003-01 | LINE Webhook署名検証を行う |
| NFR-003-02 | 環境変数でシークレットを管理する |
| NFR-003-03 | SQLインジェクション対策（Prisma使用） |
| NFR-003-04 | XSS対策（React自動エスケープ） |

### NFR-004: スケーラビリティ
| ID | 要件 | 目標値 |
|----|------|--------|
| NFR-004-01 | 同時診断ユーザー | 100人 |
| NFR-004-02 | LINE配信 | 1,000メッセージ/日 |
| NFR-004-03 | DB登録ユーザー | 10,000人 |

## ユーザーストーリー

### US-001: 診断を受ける
```
As a 金融初心者
I want to 自分の金融タイプを知りたい
So that 自分に合った学習方法がわかる
```

### US-002: LINEで情報を受け取る
```
As a 診断を受けたユーザー
I want to LINEで継続的に情報を受け取りたい
So that 無理なく金融知識を身につけられる
```

### US-003: ニュースダイジェストを読む
```
As a LINE登録ユーザー
I want to 自分に関連する金融ニュースを読みたい
So that 最新情報をキャッチアップできる
```

## 制約事項

1. LINE公式アカウント（無料プラン）の制限
   - 月間メッセージ数上限あり
   - リッチメニューは1パターンのみ

2. Vercel Free Tierの制限
   - Serverless Function実行時間 10秒
   - 帯域幅制限

3. Claude API
   - レート制限あり
   - コスト管理が必要
